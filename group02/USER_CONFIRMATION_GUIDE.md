# 用户确认功能使用指南

## 功能概述

现在`UserProxyAgent`已经配置为在执行代码前需要用户确认。这意味着：

1. **每次代码执行前都会显示命令** - 系统会在终端中显示即将执行的命令
2. **需要用户确认** - 您需要在终端中输入确认信息
3. **安全可控** - 您可以审查每个命令后再决定是否执行

## 使用方法

### 1. 启动应用
```bash
./start_app.sh
```

### 2. 在Web界面中输入产品需求
- 访问 http://localhost:7860
- 输入您的产品需求描述
- 点击"生成产品Demo"

### 3. 监控终端输出
当Agent需要执行代码时，您会在终端中看到类似这样的提示：

```
🔧 启用用户确认模式 - 代码执行前会显示命令并等待您的确认
💡 在终端中，您可以输入 'y' 或 'yes' 来确认执行，输入 'n' 或 'no' 来拒绝
📝 或者直接按回车键来跳过当前步骤

===========================================
即将执行的命令:
python test_app.py
===========================================
是否执行此命令? (y/n/回车跳过): 
```

### 4. 确认选项
- **输入 `y` 或 `yes`** - 确认执行命令
- **输入 `n` 或 `no`** - 拒绝执行命令
- **直接按回车键** - 跳过当前步骤，继续下一步

## 常见场景

### 代码测试
当Agent生成测试代码时，可能会提示执行：
```
python test_demo.py
```
您可以选择执行来验证代码是否正常工作。

### 文件创建
当Agent需要创建文件时，可能会提示：
```
mkdir -p frontend
echo "<!DOCTYPE html>..." > frontend/index.html
```

### 依赖安装
当Agent需要安装依赖时，可能会提示：
```
pip install flask
```

## 安全提示

⚠️ **请仔细审查每个命令**：
- 检查命令是否安全
- 确认命令不会删除重要文件
- 注意是否有需要管理员权限的命令

✅ **安全的命令示例**：
- `python test.py` - 运行测试脚本
- `mkdir demo` - 创建目录
- `echo "content" > file.txt` - 创建文件

❌ **需要谨慎的命令示例**：
- `sudo rm -rf /` - 危险的删除命令
- `sudo apt-get install` - 需要管理员权限
- `curl | bash` - 执行远程脚本

## 配置说明

当前配置位于 `agents.py` 文件中：

```python
code_execution_config={
    "work_dir": "generated_code",  # 代码执行目录
    "use_docker": False,           # 不使用Docker
    "timeout": 60,                 # 超时时间60秒
    "last_n_messages": 3,          # 考虑最近3条消息
},
human_input_mode="ALWAYS",        # 总是需要用户确认
```

## 故障排除

### 1. 终端没有显示确认提示
- 检查应用是否正常启动
- 确认在启动应用的终端窗口中查看

### 2. 输入确认后没有反应
- 确保在正确的终端窗口中输入
- 检查是否有其他错误信息

### 3. 代码执行失败
- 检查工作目录 `generated_code` 是否存在
- 确认Python环境配置正确
- 查看错误信息进行调试

## 日志和调试

- 代码执行的工作目录：`generated_code/`
- 生成的文件会保存在：`generated_demo/`
- 应用日志会在终端中显示

## 关闭用户确认功能

如果您想关闭用户确认功能，可以修改 `agents.py` 文件：

```python
# 将这行
human_input_mode="ALWAYS",

# 改为
human_input_mode="NEVER",
```

然后重新启动应用。 